<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>antaris' repository</title>
<style>
:root{--bg:#0b1020;--panel:#10172a;--muted:#9fb0d0;--fg:#e6edff;--acc:#7aa2ff;--acc2:#37d2a7;--danger:#ff6b6b;--card:#0f1528;--border:#1d2742;--shadow:0 10px 30px rgba(0,0,0,.35);--radius:14px;--bgimg:none}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:
    radial-gradient(1200px 800px at 10% -10%, #1b2652 0%, transparent 46%),
    radial-gradient(1000px 600px at 110% -10%, #17334f 0%, transparent 45%),
    var(--bg);
  color:var(--fg);
  font:15px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
}
/* Foto-Hintergrund (falls gefunden) + dunkles Overlay für Lesbarkeit */
body.with-photo{
  background-image:
    linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.55)),
    var(--bgimg),
    radial-gradient(1200px 800px at 10% -10%, #1b2652 0%, transparent 46%),
    radial-gradient(1000px 600px at 110% -10%, #17334f 0%, transparent 45%);
  background-color: var(--bg);
  background-size: auto, cover, auto, auto;
  background-position: center, center, 0 0, 0 0;
  background-repeat: no-repeat, no-repeat, no-repeat, no-repeat;
}

a{color:var(--acc);text-decoration:none}
a:hover{text-decoration:underline}
header{position:sticky;top:0;z-index:5;backdrop-filter:blur(8px);background:linear-gradient(180deg,rgba(16,23,42,.9),rgba(16,23,42,.6));border-bottom:1px solid var(--border)}
.container{max-width:1100px;margin:0 auto;padding:16px}
.title{display:flex;align-items:center;gap:12px}
.logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--acc),var(--acc2));display:grid;place-items:center;color:#0b1020;font-weight:800;box-shadow:var(--shadow)}
.controls{display:grid;grid-template-columns:1fr auto auto;gap:10px;margin-top:12px}
.search{position:relative}
.search input{width:100%;padding:12px 14px 12px 38px;border-radius:var(--radius);border:1px solid var(--border);background:var(--panel);color:var(--fg)}
.search svg{position:absolute;top:50%;left:12px;transform:translateY(-50%);opacity:.6}
.pill{border-radius:999px;border:1px solid var(--border);background:var(--panel);color:var(--fg);padding:10px 14px;display:inline-flex;gap:8px;align-items:center;cursor:pointer}
.pill input{accent-color:var(--acc)}
.btn{border-radius:10px;padding:10px 14px;border:1px solid var(--border);background:var(--panel);color:var(--fg);cursor:pointer}
.btn:hover{border-color:#2a3a66}
.crumbs{margin-top:10px;color:var(--muted);font-size:14px;white-space:nowrap;overflow:auto}
.crumbs a{color:var(--fg);opacity:.9}
.crumbs .sep{opacity:.4;margin:0 6px}
main{padding:18px 16px 32px}
.panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
table{width:100%;border-collapse:collapse}
thead th{text-align:left;font-weight:600;color:var(--muted);background:rgba(0,0,0,.15)}
th,td{padding:12px 14px;border-bottom:1px solid var(--border)}
tbody tr:hover{background:rgba(122,162,255,.08)}
.namecell{display:flex;align-items:center;gap:10px}
.fileicon,.foldericon{width:22px;height:22px;border-radius:6px;display:grid;place-items:center}
.foldericon{background:rgba(122,162,255,.18);color:var(--acc)}
.fileicon{background:rgba(55,210,167,.18);color:var(--acc2)}
.empty{padding:28px;text-align:center;color:var(--muted)}
details.settings{margin-top:14px;border:1px dashed var(--border);border-radius:var(--radius);padding:8px 12px;background:rgba(0,0,0,.1)}
details.settings summary{cursor:pointer;color:var(--muted)}
.settings-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:10px}
.settings-grid label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
.settings-grid input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:var(--panel);color:var(--fg)}
.settings-actions{display:flex;gap:10px;margin-top:10px}
footer{color:var(--muted);font-size:13px;padding:24px 16px 60px;text-align:center}
code.kv{background:rgba(255,255,255,.06);padding:2px 6px;border-radius:6px}
.tag{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
@media (max-width:700px){.controls{grid-template-columns:1fr}.settings-grid{grid-template-columns:1fr}}

/* --- README Block (Markdown gerendert) --- */
.readme-wrap{margin-top:18px}
.readme-head{font-weight:600;margin:6px 0 8px}
.readme-panel{border:1px solid var(--border);border-radius:var(--radius);background:var(--panel);max-height:420px;overflow:auto;padding:14px}
.readme-content{font:14px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial}
.readme-content h1,.readme-content h2,.readme-content h3{margin:12px 0 8px}
.readme-content p{margin:8px 0}
.readme-content pre{background:rgba(255,255,255,.06);padding:10px;border-radius:10px;overflow:auto}
.readme-content code{font:13px/1.5 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New";background:rgba(255,255,255,.06);padding:0 4px;border-radius:6px}
.readme-content pre code{background:none;padding:0}
.readme-content blockquote{border-left:3px solid var(--border);padding-left:10px;color:var(--muted);margin:8px 0}
.readme-content table{border-collapse:collapse;width:100%;margin:10px 0}
.readme-content th,.readme-content td{border:1px solid var(--border);padding:6px 8px}
.readme-muted{color:var(--muted);font-size:13px}

/* --- Mini-Gallery --- */
.gallery-wrap{margin-top:18px}
.gallery{position:relative;border:1px solid var(--border);border-radius:var(--radius);background:var(--panel);padding:10px 36px}
.gal-strip{display:flex;gap:10px;overflow:hidden;scroll-behavior:smooth}
.gal-item{flex:0 0 auto;width:180px;border:1px solid var(--border);border-radius:12px;background:var(--card);text-align:center;cursor:pointer}
.gal-item img{display:block;width:100%;height:110px;object-fit:cover;border-top-left-radius:12px;border-top-right-radius:12px}
.gal-caption{font-size:12px;color:var(--muted);padding:6px 8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.gal-nav{position:absolute;top:50%;transform:translateY(-50%);width:28px;height:28px;border:1px solid var(--border);background:var(--card);border-radius:50%;display:grid;place-items:center;cursor:pointer;user-select:none}
.gal-prev{left:6px}.gal-next{right:6px}
.gal-empty{color:var(--muted);padding:10px 0;text-align:center}
</style>
</head>
<body>
<header>
  <div class="container">
    <div class="title">
      <div class="logo">∑</div>
      <div>
        <div style="font-weight:700;font-size:18px">antaris' repository</div>
        <div style="color:var(--muted);font-size:13px">Listet Dateien &amp; Ordner dieses Repos (Client-Side, GitHub API)</div>
      </div>
    </div>

    <div class="controls">
      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.6"/></svg>
        <input id="search" placeholder="Suchen… (Name, Endung)" />
      </div>
      <label class="pill"><input type="checkbox" id="toggleHidden"> Versteckte Dateien anzeigen</label>
      <button id="btnUp" class="btn" title="Eine Ebene nach oben">↑ Ebene</button>
    </div>

    <div class="crumbs" id="breadcrumbs"></div>

    <details class="settings">
      <summary>Erweitert: Repo/Branch/Prefix konfigurieren</summary>
      <div class="settings-grid">
        <div><label>Owner</label><input id="cfgOwner" placeholder="z. B. antaris"/></div>
        <div><label>Repo</label><input id="cfgRepo" placeholder="z. B. mein-repo"/></div>
        <div><label>Branch <span class="tag">auto</span></label><input id="cfgBranch" placeholder="gh-pages / main / master"/></div>
        <div><label>Prefix im Repo (z. B. <code>docs</code>)</label><input id="cfgPrefix" placeholder="optional, ohne führenden /"/></div>
        <div style="grid-column:1 / -1"><label>GitHub Token (optional, erhöht Rate-Limit)</label><input id="cfgToken" type="password" placeholder="github_pat_… / ghp_…"/></div>
      </div>
      <div class="settings-actions">
        <button class="btn" id="btnSave">Speichern</button>
        <button class="btn" id="btnReset">Reset</button>
        <span id="authInfo" class="tag" title="Authentifizierung / Rate-Limit">–</span>
      </div>
      <div style="margin-top:10px;color:var(--muted);font-size:13px">
        Hinweis: Parameter können auch per Query-String gesetzt werden:
        <code class="kv">?p=unter/ordner&owner=NAME&repo=REPO&branch=main&prefix=docs</code>
      </div>
    </details>
  </div>
</header>

<main class="container">
  <!-- Dateien/Ordner -->
  <div class="panel">
    <table>
      <thead><tr><th>Name</th><th>Größe</th><th>Typ</th></tr></thead>
      <tbody id="tbody">
        <tr><td colspan="3" class="empty">Lade…</td></tr>
      </tbody>
    </table>
  </div>

  <!-- README-Block -->
  <div class="readme-wrap" id="readmeWrap" style="display:none">
    <div class="readme-head">README</div>
    <div class="readme-panel">
      <div class="readme-content" id="readmeContent"><span class="readme-muted">Lade README…</span></div>
    </div>
  </div>

  <!-- Mini-Gallery + Rate-Limit Bubble -->
  <div class="gallery-wrap">
    <div style="display:flex;align-items:center;gap:8px;margin:6px 0 8px">
      <div style="font-weight:600">Gallery (bis 5 Bilder aus dem Repo)</div>
      <div id="ratelimit" class="tag" title="GitHub Rate Limit">–/–</div>
    </div>
    <div class="gallery">
      <button class="gal-nav gal-prev" id="galPrev" aria-label="Zurück">‹</button>
      <div class="gal-strip" id="galStrip">
        <div class="gal-empty" id="galEmpty">Suche Bilder…</div>
      </div>
      <button class="gal-nav gal-next" id="galNext" aria-label="Weiter">›</button>
    </div>
  </div>

  <div id="error" class="empty" style="display:none;color:var(--danger)"></div>
</main>

<footer>
  <div>
    Erstellt von <span style="opacity:.8">index.html</span>. Nutzt die GitHub REST API (<em>ohne</em> Server-Code).<br/>
    Unauthentifiziertes Rate-Limit: <strong>60</strong> Anfragen/Stunde/IP. Mit Token: <strong>5 000</strong>.
  </div>
  <div style="margin-top:8px">
    Gesamt: <strong id="rateTotal">–</strong> • Verbleibend: <strong id="rateRemain">–</strong>
  </div>
</footer>

<!-- Markdown Renderer + Sanitizer -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>

<script>
(function(){
  'use strict';

  // ⚠️ Niemals echte Secrets hier hart verdrahten! (nur lokal denkbar)
  const HARDCODED_TOKEN = ''; // leer lassen für Deploy
  function isLocalhost(){ return ['localhost','127.0.0.1','::1'].includes(location.hostname); }

  const qs = new URLSearchParams(location.search);
  const $ = s => document.querySelector(s);
  const tbody = $('#tbody');
  const breadcrumbsEl = $('#breadcrumbs');
  const searchInput = $('#search');
  const toggleHidden = $('#toggleHidden');
  const btnUp = $('#btnUp');
  const readmeWrap = $('#readmeWrap');
  const readmeContent = $('#readmeContent');

  const IMAGE_EXT = /\.(png|jpe?g|gif|webp|svg|bmp|avif)$/i;
  const BG_NAME_RE = /^background\.(png|jpe?g|gif|webp|svg|bmp|avif)$/i;

  const store = {
    get(){ try { return JSON.parse(localStorage.getItem('dirindex.cfg')||'{}'); } catch { return {}; } },
    set(v){ localStorage.setItem('dirindex.cfg', JSON.stringify(v)); }
  };

  function siteBase(){
    const host = location.hostname;
    const path = location.pathname;
    if (/\.github\.io$/i.test(host)) {
      const segs = path.split('/').filter(Boolean);
      if (segs.length>0) return '/' + segs[0] + '/';
    }
    return '/';
  }

  function currentFolderInSite(){
    let p = location.pathname;
    const base = siteBase();
    if (p.startsWith(base)) p = p.slice(base.length - 1);
    p = p.replace(/index\.html?$/i, '');
    const qp = qs.get('p');
    if (qp) {
      p = ('/' + qp).replace(/\/+/g,'/');
      if (!p.endsWith('/')) p += '/';
    }
    return p;
  }

  function inferOwnerRepo(cfg){
    const host = location.hostname;
    const path = location.pathname;
    if (/\.github\.io$/i.test(host)) {
      const owner = host.split('.')[0];
      const segs = path.split('/').filter(Boolean);
      const repo = segs.length>0 ? segs[0] : (owner + '.github.io');
      return { owner, repo };
    }
    return { owner: cfg.owner, repo: cfg.repo };
  }

  function bytes(n){
    if (n==null) return '—';
    if (n<1024) return n+' B';
    if (n<1024*1024) return (n/1024).toFixed(1)+' KB';
    return (n/1024/1024).toFixed(2)+' MB';
  }

  function esc(s){
    return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
  }

  function linkify(escaped){
    return escaped.replace(/(https?:\/\/[^\s)]+)(?![^<]*>)/g, '<a href="$1" target="_blank" rel="noopener">$1</a>');
  }

  function joinUrl(...parts){
    return parts.map((p,i)=> i===0? String(p).replace(/\/?$/,'') : String(p).replace(/^\/+/, '')).join('/');
  }

  function encodePath(p){ return p.split('/').map(encodeURIComponent).join('/'); }

  function applySettingsToUI(cfg){
    $('#cfgOwner').value = cfg.owner||'';
    $('#cfgRepo').value = cfg.repo||'';
    $('#cfgBranch').value = cfg.branch||'';
    $('#cfg
