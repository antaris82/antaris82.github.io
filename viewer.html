<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Viewer</title>
  <link rel="stylesheet" href="assets/app.css">
  <style>
    body{margin:0;background:#0b1117;color:#e7eef5;font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial}
    .wrap{max-width:900px;margin:0 auto;padding:18px 14px 60px}
    header{position:sticky;top:0;background:#0e141b;border-bottom:1px solid #1b2632}
    header .row{display:flex;gap:10px;align-items:center;padding:10px 14px}
    header a,header button{background:#2f81f7;color:#fff;border:0;border-radius:10px;padding:8px 12px;text-decoration:none}
    header a.secondary{background:#26303c}
    .content{background:#0c1218;border:1px solid #1b2632;border-radius:12px;padding:18px}
    .content pre{background:#0f1922;border:1px solid #223042;border-radius:10px;padding:12px;overflow:auto}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
</head>
<body>
  <header>
    <div class="row">
      <button onclick="window.print()">Als PDF speichern</button>
      <a id="raw" target="_blank" rel="noopener">Raw öffnen</a>
      <a id="gh" target="_blank" rel="noopener" class="secondary">Auf GitHub</a>
      <div id="path" style="margin-left:auto;color:#8aa0b4;font-family:ui-monospace,Menlo,Consolas,monospace"></div>
    </div>
  </header>
  <div class="wrap">
    <div id="md" class="content">Lade…</div>
  </div>

<script type="module">
const qs=new URLSearchParams(location.search);
const path=qs.get("path")||"";
const raw="/"+encodeURI(path.replace(/^\/+/,""));
document.getElementById("raw").href=raw;
document.getElementById("gh").href="https://github.com/antaris82/antaris82.github.io/blob/main/"+encodeURI(path);
document.getElementById("path").textContent=path||"—";

async function fetchText(u){const r=await fetch(u,{cache:"no-store"}); if(!r.ok) throw new Error(r.status+" "+r.statusText); return r.text();}
function waitKaTeX(){return new Promise((res,rej)=>{let n=0;(function step(){if(window.renderMathInElement) return res(); if(++n>200) return rej(new Error("KaTeX nicht verfügbar")); setTimeout(step,30);})();});}

async function run(){
  try{
    const text=await fetchText(raw);
    marked.setOptions({gfm:true, breaks:false});
    const html=DOMPurify.sanitize(marked.parse(text));
    const md=document.getElementById("md");
    md.innerHTML=html;
    try{ await waitKaTeX(); renderMathInElement(md, {
      delimiters:[
        {left:"$$", right:"$$", display:true},
        {left:"\\[", right:"\\]", display:true},
        {left:"\\(", right:"\\)", display:false},
        {left:"$",  right:"$",  display:false}
      ],
      throwOnError:false, strict:"ignore"
    }); }catch(e){ console.warn(e); }
  }catch(e){
    document.getElementById("md").innerHTML = `<p style="color:#ff9a9a">Datei konnte nicht geladen werden: ${e.message}</p>`;
  }
}
run();
</script>
</body>
</html>
